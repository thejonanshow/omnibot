name: Auto-Migrate Frontend

on:
pull_request:
types: [opened, synchronize]
paths:
- ‘.migrate/**’
push:
branches:
- main
paths:
- ’.migrate/**’

jobs:
migrate:
runs-on: ubuntu-latest
permissions:
contents: write
pull-requests: write

```
steps:
  - name: Checkout
    uses: actions/checkout@v4
    with:
      fetch-depth: 0
      token: ${{ secrets.GITHUB_TOKEN }}
  
  - name: Check marker
    id: check
    run: |
      if [ -f ".migrate/MIGRATE_FRONTEND" ]; then
        echo "migrate=true" >> $GITHUB_OUTPUT
      else
        echo "migrate=false" >> $GITHUB_OUTPUT
      fi
  
  - name: Run script
    if: steps.check.outputs.migrate == 'true'
    run: bash .migrate/migrate.sh
  
  - name: Commit changes
    if: steps.check.outputs.migrate == 'true'
    run: |
      git config user.email "github-actions[bot]@users.noreply.github.com"
      git config user.name "github-actions[bot]"
      git add frontend/
      if ! git diff --cached --quiet; then
        git commit -m "chore: Auto-migrate frontend"
        git push
      fi
```
